import { Component } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { HttpClient, HttpClientModule } from '@angular/common/http';

@Component({
  selector: 'app-home',
  standalone: true,
  imports: [CommonModule, FormsModule, HttpClientModule],
  templateUrl: './home.html',
  styleUrls: ['./home.css']
})
export class Home {
  prompt: string = '';
  isSubmitting = false;
  submittedPrompts: string[] = [];
  backendResponse: string = '';   // üëà store backend response

  constructor(private http: HttpClient) {}

  submitPrompt(): void {
    const text = this.prompt.trim();
    if (!text || this.isSubmitting) return;

    this.isSubmitting = true;
    this.backendResponse = '';

    // ‚úÖ Call backend API instead of just simulating
    this.http.post<{ answer: string }>('http://127.0.0.1:5000/ask', { question: text })
      .subscribe({
        next: (res) => {
          console.log('Backend response:', res);
          this.submittedPrompts.push(text);
          this.backendResponse = res.answer;   // store response
          this.prompt = '';
          this.isSubmitting = false;
        },
        error: (err) => {
          console.error('Error:', err);
          this.backendResponse = '‚ö†Ô∏è Could not connect to backend';
          this.isSubmitting = false;
        }
      });
  }

  clearPrompt(): void {
    if (this.isSubmitting) return;
    this.prompt = '';
  }


<div class="home-center dark-theme" style="--header-h: 0px;">
  <section class="prompt-card" role="region" aria-labelledby="promptTitle">
    <h2 class="title" id="promptTitle">Ask anything</h2>

    <label class="sr-only" for="promptInput">Your prompt</label>
    <textarea
      id="promptInput"
      class="prompt-input"
      [(ngModel)]="prompt"
      placeholder="Type your prompt here‚Ä¶"
      (keydown.control.enter)="submitPrompt()"
      (keydown.meta.enter)="submitPrompt()"
    ></textarea>

    <div class="actions">
      <button class="clear-btn" type="button" (click)="clearPrompt()" [disabled]="!prompt.length || isSubmitting">
        Clear
      </button>
      
      <button class="primary-btn" type="button" (click)="submitPrompt()" [disabled]="isSubmitDisabled">
        {{ isSubmitting ? 'Submitting‚Ä¶' : 'Submit' }}
      </button>
    </div>

    <!-- Submitted prompts displayed below -->
    <div class="submitted-prompts" *ngIf="submittedPrompts.length">
      <h3 class="submitted-title">Submitted Prompts:</h3>
      <div class="prompt-card-small" *ngFor="let p of submittedPrompts">
        {{ p }}
      </div>
    </div>

    <!-- üëá Show backend response -->
    <div *ngIf="backendResponse" class="response-box">
      <h3>Backend Response:</h3>
      <p>{{ backendResponse }}</p>
    </div>
  </section>
</div>

  get isSubmitDisabled(): boolean {
    return !((this.prompt ?? '').trim()) || this.isSubmitting;
  }
}
